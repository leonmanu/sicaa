// cursoLocalList

<!DOCTYPE html>
<html lang="es" data-bs-theme="dark">
<head>
    <title>Nodo CIIE - Mis Cursos</title>
    <%- include('../../partials/head') %>
</head>
<body>
    <%- include('../../partials/navbar') %>
    <%- include('../../partials/msj') %>

    <div class="container py-5">
        <div class="row mb-4">
            <div class="col-md-8">
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb mb-2">
                        <li class="breadcrumb-item"><a href="/usuario/mis-cargos" class="text-decoration-none">Mis Cargos</a></li>
                        <li class="breadcrumb-item active" aria-current="page">Gestión de Cursos</li>
                    </ol>
                </nav>
                <h2 class="fw-bold mb-1">
                    <i class="bi bi-journal-bookmark-fill me-2 text-primary"></i>
                    <%= cargo.areaId?.nombre || 'Área General' %>
                </h2>
                <p class="text-muted mb-0">
                    <span class="badge bg-secondary me-2">CIIE <%= cargo.ciieId.nombre %></span>
                    <span class="badge bg-outline-info border border-info text-info">Clave Cargo: <%= cargo.clave %></span>
                </p>
            </div>
            <div class="col-md-4 text-md-end d-flex align-items-end justify-content-md-end mt-3 mt-md-0">
                <a href="/ciie/sincronizar-abc" class="btn btn-primary shadow-sm">
                    <i class="bi bi-plus-circle me-1"></i> Vincular Oferta ABC
                </a>
            </div>
        </div>

        <div class="row mb-4">
            <div class="col-md-3">
                <div class="card bg-dark border-secondary shadow-sm">
                    <div class="card-body py-2 px-3">
                        <small class="text-muted text-uppercase d-block" style="font-size: 0.7rem;">Cursos vinculados</small>
                        <span class="h4 fw-bold mb-0"><%= cursosLocales.length %></span>
                    </div>
                </div>
            </div>
        </div>

        <div class="card shadow-sm border-0 bg-dark text-white">
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table id="tablaCursosCargo" class="table table-dark table-hover align-middle mb-0">
                        <thead class="bg-black text-muted small text-uppercase">
                            <tr>
                                <th>Año</th>
                                <th>Propuesta</th>
                                <th>Inicio Curso</th>
                                <th>Dispositivo</th>
                                <th class="text-center pe-4">Acciones</th>
                            </tr>
                        </thead>
                        <tbody>
                            <% if (cursosLocales && cursosLocales.length > 0) { %>
                                <% cursosLocales.forEach(c => { %>
                                    <tr>
                                        <!-- <td class="ps-4">
                                            <span class="badge bg-secondary font-monospace"><%= c.idOfertaOficial %></span>
                                        </td> -->
                                        <td class="fw-bold text-info"><%= c.anio %></td>
                                        <td>
                                            <div class="text-wrap" style="max-width: 400px;"><%= c.nombrePropuesta %></div>
                                        </td>
                                        <td>
                                            <%= c.fechaInicioCurso ? new Date(c.fechaInicioCurso).toLocaleDateString('es-AR') : 'A definir' %>
                                        </td>
                                        <td>
                                            <small class="text-muted"><%= c.dispositivo %></small>
                                        </td>
                                        <td class="text-center pe-4">
                                            <div class="btn-group" role="group">
                                                <a href="/agente/inscriptos/curso/<%= c.idOfertaOficial %>" class="btn btn-sm btn-outline-primary" title="Ver alumnos">
                                                    <i class="bi bi-people-fill"></i>
                                                </a>
                                                <button class="btn btn-sm btn-outline-secondary" 
                                                        onclick="copyToClipboard('<%= c.enlaceInscripcion %>')"
                                                        title="Copiar link de inscripción">
                                                    <i class="bi bi-link-45deg"></i>
                                                </button>
                                                <button class="btn btn-sm btn-outline-danger" title="Desvincular">
                                                    <i class="bi bi-trash"></i>
                                                </button>
                                            </div>
                                        </td>
                                    </tr>
                                <% }); %>
                            <% } else { %>
                                <tr>
                                    <td colspan="6" class="text-center py-5">
                                        <p class="text-muted mb-0 italic">No hay cursos vinculados a este cargo.</p>
                                    </td>
                                </tr>
                            <% } %>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <%- include('../../partials/scripts') %>

    <script>
        $(document).ready(function() {
            $('#tablaCursosCargo').DataTable({
                language: { url: 'https://cdn.datatables.net/plug-ins/1.13.6/i18n/es-ES.json' },
                responsive: true,
                order: [[1, 'desc'], [3, 'desc']] // Ordena por Año y luego por Fecha de Inicio
            });
        });

        // Función rápida para el botón de copiar enlace
        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                alert('Enlace de inscripción copiado al portapapeles');
            });
        }
    </script>
</body>
</html>