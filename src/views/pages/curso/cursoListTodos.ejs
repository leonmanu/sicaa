<!DOCTYPE html>
<html lang="es" data-bs-theme="dark">
<head>
    <title>CIIE - Todos los Cursos</title>
    <%- include('../../partials/head') %>
</head>
<body>
    <%- include('../../partials/navbar') %>
    <%- include('../../partials/msj') %>

    <div class="container-fluid py-5 px-4">
        <div class="row mb-4">
            <div class="col-md-8">
                <h2 class="fw-bold mb-1">
                    <i class="bi bi-collection-play-fill me-2 text-primary"></i>
                    Catálogo General de Cursos
                </h2>
                <p class="text-muted mb-0">Listado completo de ofertas vinculadas al CIIE</p>
            </div>
        </div>

        <div class="card shadow-sm border-0 bg-dark text-white">
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table id="tablaGeneralCursos" class="table table-dark table-hover align-middle mb-0">
                        <thead class="bg-black text-muted small text-uppercase">
                            <tr>
                                <th>Inicio</th>
                                <th>Área / Nivel</th>
                                <th>Formador (ETR)</th>
                                <th>Propuesta</th>
                                <th>Disp</th>
                                <th><i class="bi bi-people-fill"></i></th>
                                
                                <th class="text-center pe-4">Acciones</th>
                            </tr>
                        </thead>
                        <tbody>
                            <% if (cursosLocales && cursosLocales.length > 0) { %>
                                <% cursosLocales.forEach(c => { %>
                                    <tr>
                                        <td class="small">
                                            <%= c.fechaInicioCurso ? new Date(c.fechaInicioCurso).toLocaleDateString('es-AR') : 'A definir' %>
                                        </td>
                                        
                                        <td>
                                            <div class="fw-bold" style="font-size: 0.85rem;">
                                                <%= c.cargoId?.areaId?.nombre || 'S/A' %>
                                            </div>
                                            <small class="text-muted"><%= c.cargoId?.areaId?.nivel || '' %></small>
                                        </td>

                                        <td>
                                            <% 
                                                // Ruta: Curso -> Cargo -> Ocupante -> Usuario -> Persona (referenciaId)
                                                const docente = c.cargoId?.ocupante?.usuarioId?.referenciaId;
                                            %>
                                            <% if (docente) { %>
                                                <div style="font-size: 0.85rem;">
                                                    <i class="bi bi-person-check-fill text-success me-1"></i>
                                                    <%= docente.apellido %>, <%= docente.nombre %>
                                                </div>
                                                <small class="text-muted" style="font-size: 0.7rem;">
                                                    <%= c.cargoId.ocupante.situacionRevista %>
                                                </small>
                                            <% } else { %>
                                                <span class="badge bg-danger-subtle text-danger" style="font-size: 0.65rem;">VACANTE / S.D.</span>
                                            <% } %>
                                        </td>

                                        <td>
                                            <div class="text-wrap" style="max-width: 300px; font-size: 0.85rem;">
                                                <%= c.nombrePropuesta %>
                                            </div>
                                        </td>
                                        
                                        <td>
    <% 
        // Definimos las siglas rápido
        let sigla = 'S/D';
        let color = '#6c757d'; // Gris por defecto

        if (c.dispositivo === 'Taller en Servicio') { sigla = 'TES'; color = '#198754'; }
        else if (c.dispositivo === 'Seminario') { sigla = 'SEM'; color = '#d63384'; }
        else if (c.dispositivo === 'Extensión CIIE') { sigla = 'EXT'; color = '#fd7e14'; }
        else if (c.dispositivo === 'Curso Distancia') { sigla = 'CDI'; color = '#0d6efd'; }
        else if (c.dispositivo === 'Ateneo Distancia') { sigla = 'ATD'; color = '#6f42c1'; }
        else if (c.dispositivo === 'MADP + Ateneo') { sigla = 'MADP'; color = '#20c997'; }
        else if (c.dispositivo === 'Seminario Distancia') { sigla = 'SED'; color = '#e83e8c'; }
        else if (c.dispositivo === 'Taller Fuera de Servicio') { sigla = 'TFS'; color = '#adb5bd'; }
    %>
    
    <span class="badge border" 
          style=" color: <%= color %>; border-color: <%= color %>; background-color: <%= color %>15;" 
          title="<%= c.dispositivo %>">
        <%= sigla %>
    </span>
</td>
                                        
                                        <td>
                                            <%= c.cantidadInscriptos %>
                                        </td>

                                        <td class="text-center">
    <div class="d-flex justify-content-center gap-2">
        <a href="/ciie/inscriptos/curso/<%= c.idOfertaOficial %>" 
           class="btn btn-outline-primary d-flex align-items-center justify-content-center" 
           style="width: 40px; height: 40px; border-radius: 10px;" 
           title="Ver alumnos">
            <i class="bi bi-people-fill fs-5"></i>
        </a>

        <button class="btn btn-outline-secondary d-flex align-items-center justify-content-center" 
                style="width: 40px; height: 40px; border-radius: 10px;"
                onclick="copyToClipboard('<%= c.enlaceInscripcion %>')"
                title="Copiar link">
            <i class="bi bi-link-45deg fs-5"></i>
        </button>
    </div>
</td>
                                    </tr>
                                <% }); %>
                            <% } else { %>
                                <tr>
                                    <td colspan="7" class="text-center py-5 text-muted">No hay cursos registrados.</td>
                                </tr>
                            <% } %>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <%- include('../../partials/scripts') %>

    <script>
        $(document).ready(function() {
            $('#tablaGeneralCursos').DataTable({
                language: { url: 'https://cdn.datatables.net/plug-ins/1.13.6/i18n/es-ES.json' },
                responsive: true,
                order: [[0, 'desc'], [1, 'asc']],
                // --- CONFIGURACIÓN PARA MOSTRAR TODO SIN LÍMITE ---
                paging: false,          // Desactiva la paginación (muestra todo de una vez)
                info: true,            // Muestra "Mostrando X de X registros"
                lengthChange: false,   // Quita el selector de "Mostrar 10, 25..."
                scrollCollapse: true,
                dom: '<"d-flex justify-content-between align-items-center mb-3"f>t<"p-3"i>', // Solo buscador arriba (f) y tabla (t)
            });
        });

        function copyToClipboard(text) {
            if(!text) return;
            navigator.clipboard.writeText(text).then(() => {
                alert('Enlace copiado');
            });
        }
    </script>
</body>
</html>