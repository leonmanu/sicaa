<!DOCTYPE html>
<html lang="es" data-bs-theme="dark">
<head>
    <title>CIIE - Planta ETR</title>
    <%- include('../../partials/head') %>
</head>
<body>
    <%- include('../../partials/navbar') %>
    
    <div class="container-fluid py-5 px-4">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <div>
                <h2 class="fw-bold text-uppercase">üéì Planta ETR <small class="text-muted fs-5">| Formadores</small></h2>
                <p class="text-muted mb-0">Gesti√≥n de cargos y acceso directo a inscriptos</p>
            </div>
            <div class="text-end">
                <span class="badge bg-primary p-2 fs-6 shadow-sm">Total ETR: <%= cargos.length %></span>
            </div>
        </div>

        <div class="card bg-dark border-secondary shadow-lg">
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table id="tablaETR" class="table table-dark table-hover align-middle mb-0">
                        <thead class="table-secondary text-dark">
                            <tr>
                                <th>√Årea y Nivel</th>
                                <th>Formador / ETR</th>
                                <th>Situaci√≥n</th>
                                <th>Estado</th>
                                <th class="text-center">Acciones</th>
                            </tr>
                        </thead>
                        <tbody>
                            <% if (cargos && cargos.length > 0) { %>
                                <% cargos.forEach(cargo => { %>
                                    <tr>
                                        <td>
                                            <div class="fw-bold text-info">
                                                <%= cargo.areaId?.nombre || 'Sin √Årea' %>
                                            </div>
                                            <div class="d-flex align-items-center">
                                                <span class="text-secondary small me-2">
                                                    <%= cargo.areaId?.nivel || '' %>
                                                </span>
                                                <% if (cargo.comision > 1) { %>
                                                    <span class="badge bg-dark border border-info text-info rounded-pill px-2" style="font-size: 0.7rem;">
                                                        C<%= cargo.comision %>
                                                    </span>
                                                <% } %>
                                            </div>
                                        </td>

                                        <td>
                                            <% if (cargo.ocupante && cargo.ocupante.usuarioId) { %>
                                                <div class="d-flex flex-column">
                                                    <span class="fw-bold"><%= cargo.ocupante.usuarioId.email.split('@')[0] %></span>
                                                    <small class="text-muted italic" style="font-size: 0.75rem;"><%= cargo.ocupante.usuarioId.email %></small>
                                                </div>
                                            <% } else { %>
                                                <span class="text-danger small fw-bold">VACANTE</span>
                                            <% } %>
                                        </td>

                                        <td class="small text-uppercase">
                                            <%= cargo.ocupante?.situacionRevista || '-' %>
                                        </td>

                                        <td>
                                            <% if (cargo.ocupante?.estado === 'Activo') { %>
                                                <span class="text-success small"><i class="bi bi-circle-fill me-1" style="font-size: 0.5rem;"></i> Activo</span>
                                            <% } else { %>
                                                <span class="text-warning small italic"><%= cargo.ocupante?.estado || 'Sin asignar' %></span>
                                            <% } %>
                                        </td>

                                        <td class="text-center">
                                            <% if (cargo.clave) { %>
                                                <div class="btn-group shadow-sm">
                                                    <a href="../cursos/cargo/<%= cargo.clave %>" 
                                                       class="btn btn-sm btn-primary px-3 fw-bold" 
                                                       title="Ver Inscriptos">
                                                        Cursos ‚ûî
                                                    </a>
                                                </div>
                                            <% } else { %>
                                                <span class="text-muted small">Sin claves de acceso</span>
                                            <% } %>
                                        </td>
                                    </tr>
                                <% }); %>
                            <% } %>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <%- include('../../partials/scripts') %>

    <script>
        $(document).ready(function() {
            $('#tablaETR').DataTable({
                language: { 
                    url: 'https://cdn.datatables.net/plug-ins/1.13.6/i18n/es-ES.json' 
                },
                responsive: true,
                paging: false,
                info: false,
                dom: '<"p-3 d-flex justify-content-between align-items-center"fB>rt',
                buttons: [
                    { extend: 'excel', className: 'btn btn-sm btn-outline-success mx-1', text: 'Excel' },
                    { extend: 'pdf', className: 'btn btn-sm btn-outline-danger mx-1', text: 'PDF' }
                ],
                order: [[0, 'asc']]
            });
        });
    </script>

    <style>
        .table thead {
            position: sticky;
            top: 0;
            z-index: 1020;
            background-color: #ced4da;
        }
        .table-secondary { border-bottom: 2px solid #444; }
        .italic { font-style: italic; }
        .btn-group .btn { font-size: 0.8rem; }
        /* Evita que el texto de los botones se rompa en varias l√≠neas */
        .btn-group { white-space: nowrap; }
    </style>
</body>
</html>